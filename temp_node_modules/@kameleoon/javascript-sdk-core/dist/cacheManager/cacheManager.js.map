{"version":3,"file":"cacheManager.js","names":["_types","require","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","CacheManager","constructor","cleanupTimeout","Map","Milliseconds","Second","add","data","lifetime","intervalId","activate","expirationTime","cacheItem","Date","now","cacheMap","set","getAliveItem","get","delete","setInterval","item","size","cleanupInterval","clearInterval","exports"],"sources":["../../src/cacheManager/cacheManager.ts"],"sourcesContent":["import { AddParametersType, CacheItemType } from './types';\nimport { Milliseconds } from '../types';\n\ninterface ICacheManager<T> {\n  /**\n   * Add item to cache\n   * @param {AddParametersType<T>} parameters - parameters for adding new item cache\n   * @returns {void}\n   */\n  add({ key, data, lifetime }: AddParametersType<T>): void;\n  /**\n   * Get item that is not expired from cache\n   * @param {string} key - key of item\n   * @returns {T} an item that is not expired\n   */\n  getAliveItem(key: string): T | null;\n}\n\n/**\n * @class\n * CacheManager - a class for managing cache\n */\nexport class CacheManager<T> implements ICacheManager<T> {\n  private cacheMap = new Map<string, CacheItemType<T>>();\n  private intervalId: NodeJS.Timeout | null = null;\n  private cleanupTimeout: number;\n\n  /**\n   * @param {number} cleanupTimeout - timeout for cleaning cache in seconds\n   * generic type `T` is a type of data that will be stored in cache\n   * @example\n   * ```typescript\n   * const cacheManager = new CacheManager<number>(60);\n   * ```\n   */\n  constructor(cleanupTimeout: number) {\n    this.cleanupTimeout = cleanupTimeout * Milliseconds.Second;\n  }\n\n  public add({ key, data, lifetime }: AddParametersType<T>): void {\n    if (this.intervalId === null) {\n      this.activate();\n    }\n\n    const expirationTime = lifetime * Milliseconds.Second;\n\n    const cacheItem: CacheItemType<T> = {\n      data,\n      expirationTime: Date.now() + expirationTime,\n    };\n\n    this.cacheMap.set(key, cacheItem);\n  }\n\n  public getAliveItem(key: string): T | null {\n    const cacheItem = this.cacheMap.get(key);\n\n    if (cacheItem && cacheItem.expirationTime >= Date.now()) {\n      return cacheItem.data;\n    }\n\n    cacheItem && this.cacheMap.delete(key);\n\n    return null;\n  }\n\n  private activate(): void {\n    this.intervalId = setInterval(() => {\n      const now = Date.now();\n\n      for (const [key, item] of this.cacheMap) {\n        if (item.expirationTime < now) {\n          this.cacheMap.delete(key);\n        }\n      }\n\n      if (!this.cacheMap.size) {\n        this.cleanupInterval();\n      }\n    }, this.cleanupTimeout);\n  }\n\n  private cleanupInterval(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n  }\n}\n"],"mappings":";;;;;;AACA,IAAAA,MAAA,GAAAC,OAAA;AAAwC,SAAAC,gBAAAC,GAAA,EAAAC,GAAA,EAAAC,KAAA,IAAAD,GAAA,GAAAE,cAAA,CAAAF,GAAA,OAAAA,GAAA,IAAAD,GAAA,IAAAI,MAAA,CAAAC,cAAA,CAAAL,GAAA,EAAAC,GAAA,IAAAC,KAAA,EAAAA,KAAA,EAAAI,UAAA,QAAAC,YAAA,QAAAC,QAAA,oBAAAR,GAAA,CAAAC,GAAA,IAAAC,KAAA,WAAAF,GAAA;AAAA,SAAAG,eAAAM,GAAA,QAAAR,GAAA,GAAAS,YAAA,CAAAD,GAAA,2BAAAR,GAAA,gBAAAA,GAAA,GAAAU,MAAA,CAAAV,GAAA;AAAA,SAAAS,aAAAE,KAAA,EAAAC,IAAA,eAAAD,KAAA,iBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAG,MAAA,CAAAC,WAAA,OAAAF,IAAA,KAAAG,SAAA,QAAAC,GAAA,GAAAJ,IAAA,CAAAK,IAAA,CAAAP,KAAA,EAAAC,IAAA,2BAAAK,GAAA,sBAAAA,GAAA,YAAAE,SAAA,4DAAAP,IAAA,gBAAAF,MAAA,GAAAU,MAAA,EAAAT,KAAA;AAiBxC;AACA;AACA;AACA;AACO,MAAMU,YAAY,CAAgC;EAKvD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,WAAWA,CAACC,cAAsB,EAAE;IAAAzB,eAAA,mBAZjB,IAAI0B,GAAG,EAA4B;IAAA1B,eAAA,qBACV,IAAI;IAAAA,eAAA;IAY9C,IAAI,CAACyB,cAAc,GAAGA,cAAc,GAAGE,mBAAY,CAACC,MAAM;EAC5D;EAEOC,GAAGA,CAAC;IAAE3B,GAAG;IAAE4B,IAAI;IAAEC;EAA+B,CAAC,EAAQ;IAC9D,IAAI,IAAI,CAACC,UAAU,KAAK,IAAI,EAAE;MAC5B,IAAI,CAACC,QAAQ,EAAE;IACjB;IAEA,MAAMC,cAAc,GAAGH,QAAQ,GAAGJ,mBAAY,CAACC,MAAM;IAErD,MAAMO,SAA2B,GAAG;MAClCL,IAAI;MACJI,cAAc,EAAEE,IAAI,CAACC,GAAG,EAAE,GAAGH;IAC/B,CAAC;IAED,IAAI,CAACI,QAAQ,CAACC,GAAG,CAACrC,GAAG,EAAEiC,SAAS,CAAC;EACnC;EAEOK,YAAYA,CAACtC,GAAW,EAAY;IACzC,MAAMiC,SAAS,GAAG,IAAI,CAACG,QAAQ,CAACG,GAAG,CAACvC,GAAG,CAAC;IAExC,IAAIiC,SAAS,IAAIA,SAAS,CAACD,cAAc,IAAIE,IAAI,CAACC,GAAG,EAAE,EAAE;MACvD,OAAOF,SAAS,CAACL,IAAI;IACvB;IAEAK,SAAS,IAAI,IAAI,CAACG,QAAQ,CAACI,MAAM,CAACxC,GAAG,CAAC;IAEtC,OAAO,IAAI;EACb;EAEQ+B,QAAQA,CAAA,EAAS;IACvB,IAAI,CAACD,UAAU,GAAGW,WAAW,CAAC,MAAM;MAClC,MAAMN,GAAG,GAAGD,IAAI,CAACC,GAAG,EAAE;MAEtB,KAAK,MAAM,CAACnC,GAAG,EAAE0C,IAAI,CAAC,IAAI,IAAI,CAACN,QAAQ,EAAE;QACvC,IAAIM,IAAI,CAACV,cAAc,GAAGG,GAAG,EAAE;UAC7B,IAAI,CAACC,QAAQ,CAACI,MAAM,CAACxC,GAAG,CAAC;QAC3B;MACF;MAEA,IAAI,CAAC,IAAI,CAACoC,QAAQ,CAACO,IAAI,EAAE;QACvB,IAAI,CAACC,eAAe,EAAE;MACxB;IACF,CAAC,EAAE,IAAI,CAACrB,cAAc,CAAC;EACzB;EAEQqB,eAAeA,CAAA,EAAS;IAC9B,IAAI,IAAI,CAACd,UAAU,EAAE;MACnBe,aAAa,CAAC,IAAI,CAACf,UAAU,CAAC;MAC9B,IAAI,CAACA,UAAU,GAAG,IAAI;IACxB;EACF;AACF;AAACgB,OAAA,CAAAzB,YAAA,GAAAA,YAAA"}