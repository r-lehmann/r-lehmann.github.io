{"version":3,"file":"targetExperimentCondition.js","names":["_tsRes","require","_types","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","TargetExperimentCondition","constructor","variation","experiment","isInclude","variationMatchType","inverseResult","experimentId","variationId","matchType","evaluate","variationData","Ok","MatchTypeVariation","EXACT","result","checkCondition","experimentIdString","ANY","Boolean","exports"],"sources":["../../../src/targeting/conditions/targetExperimentCondition.ts"],"sourcesContent":["import { Ok, Result } from 'ts-res';\nimport { KameleoonError } from '../../kameleoonError';\nimport { ExperimentVariationsType } from '../../storage';\nimport { EvaluationDataType, MatchTypeVariation } from '../types';\nimport { ConditionDataType, ICondition } from './types';\n\nexport class TargetExperimentCondition implements ICondition {\n  private inverseResult: boolean;\n  private experimentId?: number | null;\n  private variationId?: number | null;\n  private matchType?: MatchTypeVariation | null;\n\n  constructor({\n    variation,\n    experiment,\n    isInclude,\n    variationMatchType,\n  }: ConditionDataType) {\n    this.inverseResult = !(isInclude ?? true);\n    this.experimentId = experiment;\n    this.variationId = variation;\n    this.matchType = variationMatchType;\n  }\n\n  evaluate({\n    variationData,\n  }: EvaluationDataType): Result<boolean, KameleoonError> {\n    if (!this.experimentId) {\n      return Ok(false);\n    }\n\n    if (this.matchType === MatchTypeVariation.EXACT && !this.variationId) {\n      Ok(false);\n    }\n\n    const result = this.checkCondition({\n      variationId: this.variationId,\n      experimentId: this.experimentId,\n      variationData,\n    });\n\n    return Ok(this.inverseResult ? !result : result);\n  }\n\n  private checkCondition({\n    variationId,\n    experimentId,\n    variationData,\n  }: {\n    variationId?: number | null;\n    experimentId: number;\n    variationData: ExperimentVariationsType;\n  }): boolean {\n    const experimentIdString = String(experimentId);\n    const variation = variationData[experimentIdString];\n\n    switch (this.matchType) {\n      case MatchTypeVariation.EXACT: {\n        return variation?.variationId === variationId;\n      }\n      case MatchTypeVariation.ANY:\n        return Boolean(variation);\n      default:\n        return false;\n    }\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAGA,IAAAC,MAAA,GAAAD,OAAA;AAAkE,SAAAE,gBAAAC,GAAA,EAAAC,GAAA,EAAAC,KAAA,IAAAD,GAAA,GAAAE,cAAA,CAAAF,GAAA,OAAAA,GAAA,IAAAD,GAAA,IAAAI,MAAA,CAAAC,cAAA,CAAAL,GAAA,EAAAC,GAAA,IAAAC,KAAA,EAAAA,KAAA,EAAAI,UAAA,QAAAC,YAAA,QAAAC,QAAA,oBAAAR,GAAA,CAAAC,GAAA,IAAAC,KAAA,WAAAF,GAAA;AAAA,SAAAG,eAAAM,GAAA,QAAAR,GAAA,GAAAS,YAAA,CAAAD,GAAA,2BAAAR,GAAA,gBAAAA,GAAA,GAAAU,MAAA,CAAAV,GAAA;AAAA,SAAAS,aAAAE,KAAA,EAAAC,IAAA,eAAAD,KAAA,iBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAG,MAAA,CAAAC,WAAA,OAAAF,IAAA,KAAAG,SAAA,QAAAC,GAAA,GAAAJ,IAAA,CAAAK,IAAA,CAAAP,KAAA,EAAAC,IAAA,2BAAAK,GAAA,sBAAAA,GAAA,YAAAE,SAAA,4DAAAP,IAAA,gBAAAF,MAAA,GAAAU,MAAA,EAAAT,KAAA;AAG3D,MAAMU,yBAAyB,CAAuB;EAM3DC,WAAWA,CAAC;IACVC,SAAS;IACTC,UAAU;IACVC,SAAS;IACTC;EACiB,CAAC,EAAE;IAAA5B,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAAAA,eAAA;IACpB,IAAI,CAAC6B,aAAa,GAAG,EAAEF,SAAS,IAAI,IAAI,CAAC;IACzC,IAAI,CAACG,YAAY,GAAGJ,UAAU;IAC9B,IAAI,CAACK,WAAW,GAAGN,SAAS;IAC5B,IAAI,CAACO,SAAS,GAAGJ,kBAAkB;EACrC;EAEAK,QAAQA,CAAC;IACPC;EACkB,CAAC,EAAmC;IACtD,IAAI,CAAC,IAAI,CAACJ,YAAY,EAAE;MACtB,OAAO,IAAAK,SAAE,EAAC,KAAK,CAAC;IAClB;IAEA,IAAI,IAAI,CAACH,SAAS,KAAKI,yBAAkB,CAACC,KAAK,IAAI,CAAC,IAAI,CAACN,WAAW,EAAE;MACpE,IAAAI,SAAE,EAAC,KAAK,CAAC;IACX;IAEA,MAAMG,MAAM,GAAG,IAAI,CAACC,cAAc,CAAC;MACjCR,WAAW,EAAE,IAAI,CAACA,WAAW;MAC7BD,YAAY,EAAE,IAAI,CAACA,YAAY;MAC/BI;IACF,CAAC,CAAC;IAEF,OAAO,IAAAC,SAAE,EAAC,IAAI,CAACN,aAAa,GAAG,CAACS,MAAM,GAAGA,MAAM,CAAC;EAClD;EAEQC,cAAcA,CAAC;IACrBR,WAAW;IACXD,YAAY;IACZI;EAKF,CAAC,EAAW;IACV,MAAMM,kBAAkB,GAAG5B,MAAM,CAACkB,YAAY,CAAC;IAC/C,MAAML,SAAS,GAAGS,aAAa,CAACM,kBAAkB,CAAC;IAEnD,QAAQ,IAAI,CAACR,SAAS;MACpB,KAAKI,yBAAkB,CAACC,KAAK;QAAE;UAC7B,OAAOZ,SAAS,EAAEM,WAAW,KAAKA,WAAW;QAC/C;MACA,KAAKK,yBAAkB,CAACK,GAAG;QACzB,OAAOC,OAAO,CAACjB,SAAS,CAAC;MAC3B;QACE,OAAO,KAAK;IAAC;EAEnB;AACF;AAACkB,OAAA,CAAApB,yBAAA,GAAAA,yBAAA"}