{"version":3,"file":"eventSource.js","names":["EventSourceConstructor","initialize","url","ExternalEventSource","exports","constructor","_defineProperty","eventSource","EventSource","open","siteCode","eventType","onEvent","addEventListener","message","event","JSON","parse","data","eventSiteCode","ts","close"],"sources":["../src/eventSource.ts"],"sourcesContent":["import {\n  RealTimeEventType,\n  IExternalEventSource,\n  EventSourceOpenParametersType,\n  IExternalEventSourceConstructor,\n} from '@kameleoon/javascript-sdk-core';\n\nexport class EventSourceConstructor implements IExternalEventSourceConstructor {\n  public initialize(url: string): IExternalEventSource {\n    return new ExternalEventSource(url);\n  }\n}\n\n// --- Note ---\n// - `EventSource` has no dedicated tests because same browser instance\n// is tested thoroughly inside core and would just duplicate tests\n// - Moreover we would have to import some unexposed details like constructed url\n// or the `eventType` from the core\nclass ExternalEventSource implements IExternalEventSource {\n  private eventSource: EventSource;\n\n  constructor(url: string) {\n    const eventSource = new EventSource(url);\n\n    this.eventSource = eventSource;\n  }\n\n  public open({\n    siteCode,\n    eventType,\n    onEvent,\n  }: EventSourceOpenParametersType): void {\n    this.eventSource.addEventListener(eventType, (message) => {\n      const event: RealTimeEventType = JSON.parse(message.data);\n      const { siteCode: eventSiteCode, ts } = event;\n\n      if (siteCode === eventSiteCode) {\n        onEvent(ts);\n      }\n    });\n  }\n\n  public close() {\n    this.eventSource.close();\n  }\n}\n"],"mappings":";;;;;;;;;AAOO,MAAMA,sBAAsB,CAA4C;EACtEC,UAAUA,CAACC,GAAW,EAAwB;IACnD,OAAO,IAAIC,mBAAmB,CAACD,GAAG,CAAC;EACrC;AACF;;AAEA;AACA;AACA;AACA;AACA;AAAAE,OAAA,CAAAJ,sBAAA,GAAAA,sBAAA;AACA,MAAMG,mBAAmB,CAAiC;EAGxDE,WAAWA,CAACH,GAAW,EAAE;IAAAI,eAAA;IACvB,MAAMC,WAAW,GAAG,IAAIC,WAAW,CAACN,GAAG,CAAC;IAExC,IAAI,CAACK,WAAW,GAAGA,WAAW;EAChC;EAEOE,IAAIA,CAAC;IACVC,QAAQ;IACRC,SAAS;IACTC;EAC6B,CAAC,EAAQ;IACtC,IAAI,CAACL,WAAW,CAACM,gBAAgB,CAACF,SAAS,EAAGG,OAAO,IAAK;MACxD,MAAMC,KAAwB,GAAGC,IAAI,CAACC,KAAK,CAACH,OAAO,CAACI,IAAI,CAAC;MACzD,MAAM;QAAER,QAAQ,EAAES,aAAa;QAAEC;MAAG,CAAC,GAAGL,KAAK;MAE7C,IAAIL,QAAQ,KAAKS,aAAa,EAAE;QAC9BP,OAAO,CAACQ,EAAE,CAAC;MACb;IACF,CAAC,CAAC;EACJ;EAEOC,KAAKA,CAAA,EAAG;IACb,IAAI,CAACd,WAAW,CAACc,KAAK,EAAE;EAC1B;AACF"}